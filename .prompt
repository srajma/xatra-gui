I have detailed a roadmap for this project in README.md. Go through it, fixing the bugs and implementing the features detailed, and relentlessly iterate until perfection.

-----

Thank you. However there are still lots of issues in this implementation:
- Why would the username be an editable field? That makes no sense. It should be the user's username (linked to the user's profile page, see below), if logged-in, or just `new_user` if not. The default name of the map should also not be `xatra` but `new_map` (or, if the user is logged-in and already has a map called `new_map` then `new_map_1`, `new_map_2` etc.)
- There should be proper user accounts and a login flow---and if possible we should have the option to login with Google account, etc. (we can put this off for later if it needs some manual setup from me). Like: right now I don't even know how to login as the admin user (srajma) and create a map with the main territory library. Obviously, don't roll your own auth, implement best practices.
- There would also need to be additional UI for managing all this. The landing page can still be the map editor, but there should be a little xatra menu button at the top left (left of the map slug) which when clicked gives a dropdown menu including:
  - Load (this should replace the current "Load Project" button we have with the same icon)
  - Save (this should replace the "Save Project" button we have, except we should change the icon to a little download icon)
  - Export (this should replace the "Export HTML" button we have, except we should change the icon to a map or image icon rather than an HTML angular brackets thing since the user doesn't really care that it's HTML---we should also just remove the "Export Map JSON" button, it's too confusing for the user especially given that Save Project also downloads a json file albeit one that serves a different purpose)
  - Night mode toggle---this replaces the last of the clutter buttons we have right now
  - Explore---opens a new tab `/explore` showing maps on the platform, in a grid layout, ordered by some sensible measure of popularity, votes (yes you have to implement votes, for logged-in users only) and recently edited, with a well-implemented search feature (which will be the same search feature we will use for imports)---there should be a hint in the search box showing `indica user:srajma` as an example of a search, and that should indeed be how the search works. The map thumbnails should ideally show little saved snapshots of the maps (which were generated earlier when the user last edited it), but we can hold that off and keep a sample thumbnail if that's too complicated.
  - My profile (for logged-in users)---loads a new tab `/<username>` which consists of the user's account info (username, optional full name and profile description, password and login/auth stuff only visible to that user) and some basic stats (number of maps created, views on that user's maps etc.). Below should be a view of the user's maps, with search and pagination if the number of items exceeds 10, and the user can load any one of them. Apart from the login stuff, everything else on the user's profile should be publicly available to all.
  - New Map... which opens a new tab on the landing page.
  - Login/Signup (for logged-out users) or Logout (for logged-in users).
  The user should be able to click on any of the maps in "Explore" which will take him to the editor for that map, available at URL /username/map/mapname (i.e. the username of the user who actually created the map). Obviously, his edits should not be stored in the other user's map, but rather if he clicks the Save button (in the version/save/copy trio that should be next to the map slug) it should save it as a "fork" of the map he was editing (with that forking clearly attributed and linked to the original map) to /hisusername/map/mapname. If he already has a map with that name, it should automatically add an `_n` at the end where `n` is the smallest integer such that a map with that name does not exist among the user's maps.
  The "Explore" and "My Profile" pages should have a sidebar which kinda looks like the expanded xatra menu, with similar links
- Re: the breakdown of the code editor
  - Your implementation should divide the code so that the Python imports:
    ```python
    import xatra
    from xatra.loaders import gadm, naturalearth, polygon, overpass
    from xatra.icon import Icon
    from xatra.colorseq import Color, ColorSequence, LinearColorSequence
    from matplotlib.colors import LinearSegmentedColormap
    ```
    should be in the Python imports section (which needs to exist, btw--you haven't created it); xatrahub imports in their section; xatra.CSS(), xatra.BaseOption(), xatra.FlagColorSequence(), xatra.AdminColorSequence(), xatra.DataColormap() elements elements in the Theme section.
- version/save/copy icons need design improvements.
  - Instead of showing the version numbering as its own separate thing, the version number and publish version buttons should be integrated, i.e. a little button displaying a tag icon (instead of the save icon) and the version number in a small monospace font (do not add brackets, write it as `v1`, `v2`, `alpha` etc.) that upon clicking publishes a new version. It should only publish a new version if there have actually been any changes (otherwise it should display a little text left of the button saying "No changes"). 
- The import from database search UI is absolutely terrible. I don't think I need to explain to you why; you should just trash this, think it through and come up with a perfect UI, which could be like a pop-up UI (which, like I said, should look the same and use the same search/browsing functionality as "Explore..."), with which the user can browse through his own as well as public maps/themes/libraries, select from a list of checkboxes which elements get imported (i.e. whatever is unselected gets passed to `filter_not`) and select for each entry that shows up whether to import the map, theme or territories (keyboard shortcuts m, c, t on focused entry) through little buttons stacked underneath each thumbnail. It should also just be called "Import from xatra hub" and should be present in the Builder not the code.
- You should of course make sure all this extra UI is subject to the light and night mode color schemes
- It should store the latest unsaved map in the database for both logged-in and logged-out users (using whatever auth/cookies/whatever idk for the latter) so it can be loaded again when the user revisits
- You do not seem to have made any edits to the original xatra package. ???
I would like you to fully and thoroughly implement a functioning website as I have asked you to, and iterate until you are sure I will be completely satisfied with your work.

-----

Thank you; however there are still clearly many avenues for improvement. I'd really like you to think through this thoroughly, thinking **from the perspective of a user**, and deliver a polished, usable product.

1) Importing maps
- I don't understand why you are so confused with the `filter_not` checkboxes. How would a user understand what `filter_not` means? And why are there only `TitleBox`, `CSS` and `BaseOption`? And why is there a checklist under each and every library item when all of them are synchronized? Again, what I said is: there should be ONE checklist (for all the items) consisting of _all_ the xatra layers (Flag, River, Data, Admin, AdminRivers, TitleBox, CSS, BaseOption, _everything_), all of which are selected at the start, and those which are un-selected are passed to `filter_not`.
- The import buttons in the Import dialog should show visual feedback when clicked---like, turn it blue and change the text to "✓ Map Imported" or "✓ Territories Imported" or "✓ CSS Imported" and make it unclickable (this should persist when the Import dialog is re-opened, i.e. it should check if that particular item is imported). There are tons of examples of things like this throughout the website, buttons just seemingly doing nothing when a request is invalid, instead of telling the user what's wrong. The buttons also need to better match the style we have in the map editor; your buttons are ugly and it's impossible to tell if it has even been clicked.
- There should be a nice UI element in the Builder sidebar for xatrahub imports, just like for Flags, Rivers etc. Removing the item should un-import that item, and make it available for import again in the Import dialog. This should also be integrated into the Builder/Code to-and-fro translation.
- the "Import from xatra hub" button should be within the second div (i.e. right above "Global options") rather than with the slug and Builder/Code toggle. It should also match the design of the map editor and should just say "Import from existing map" instead (users don't know what a "xatra hub" is).
2) Synchrony
- The explore/profile UI's sidebar should have all the options present in the xatra menu in the editor (apart from map-related ones): Night mode, Explore, My Profile (not "Profile"), New map... (not "Editor"), Login/Signup (or Logout for logged-in users). And make it look very similar to the xatra menu in style (i.e. icons etc.) It should also have a nice "xatra" title at the top of the sidebar.
- The "Import from xatra hub" dialog and the Explore page should be using the exact same code, displaying the exact same stuff etc. Right now they do not, because I can see several items in the Import dialog but nothing on the Explore page. I don't know which one is wrong, just make them both use the same thing so we can debug more sensibly.
- There's also some lack of synchrony between simply clicking "My Profile" versus clicking "Explore" and then "My Profile": the latter loads the page without the "Account settings" box, then loads the "Account settings" box after some time. That's weird and confusing.
- The maps in both Explore and the Import dialog should link to the maps so the user can open them in a new page. 
3) Login page
- There is no need for the "Need account?" "Have account?" creativity. Just have one page, with both the Sign up and Login; and make it look good and pretty.
- If I try creating an account whose username already exists, it should give me a helpful error message--right now it just doesn't say anything, which makes the user think the website is frozen. Similarly if the password is too short etc. There are tons of examples of things like this throughout the website, buttons just seemingly doing nothing when a request is invalid, instead of telling the user what's wrong. The buttons also need to better match the style we have in the map editor; your buttons are ugly and it's impossible to tell if it has even been clicked.
4) The clickable version tag + copy button on the maps themselves is (1) only available on already-saved maps, not when creating a New Map (fix this) and (2) hidden under the Builder Code toggle, as are the vote buttons. You need to maybe split all this into two lines, give it all some nicer space and design; you know, figure it out.
5) I don't know if maps are actually getting saved, because I can choose `/srajmas/map/xatra/2` in the Import dialog but when I actually try to render with that imported I get `Error: xatrahub artifact not found: /srajmas/map/xatra`.


Misc:
- why is there `indic = xatrahub("/srajma/lib/indic")` in "Custom territory library"? This should be in "xatrahub imports". The custom territory library is for custom territories the user defines in the making of _that map_.
- the style of the stuff you have introduced does not match the design style of the existing contents. Make it match.
- the xatra menu should close when the user clicks out of it. Also have a keyboard shortcut `Ctrl/Cmd+;` for toggling the menu and mention it in the keyboard shortcuts hint panel.
- remove the bracket version (like `(alpha)` or `(1)`) from code editor sub section headings
- Dark theme -- the hover color in dark mode is fully white which makes the white text invisible. Instead the hover color should just be slightly lighter than the default dark background
- There should be a keyboard shortcut `Ctrl/Cmd+Shift+X` for opening the import menu, and this should be listed in the kb shortcuts hints panel.

These are just some things I noticed off the top of my head, but over all this needs a pretty serious overhaul. I want a really polished, beautiful website---just _think from the persepctive of the user_, keep iterating until you achieve perfection. 

----------

1) Explore and Imports
a) The import panel should grey out the current map, since its contents cannot be imported into itself, obviously.
b) The system should store every published version of a map, as well as every published version of a territory library and every published version of a theme including the alpha builds which are the latest versions that may not have been saved (this should hopefully already be how it works)---in the importer, next to each "Import map" "Import CSS" "Import Territories", there should be a dropdown listing all the versions of the map (including alpha), initialized to the latest non-alpha version (or to alpha if there is no such version), and clicking the Import button should import that version. Similarly the Imports list in the Builder UI should show the version dropdown set to the selected version, and a button "Switch version" which is initally greyed out---the user can change the version in the dropdown, activating the button and click it to switch it. Both these things will require some significant changes to the UI, so do it carefully and make sure not to mess it up.
c) The version dropdown should also be available on /explore (though only the map versions, not the territory library and theme versions here) and selecting the version and clicking "Open" should take you to that version of the map, i.e. `<username>/map/<mapname>/v<n>`.

2) Creating maps, map names
a) Creating a new map seems to initialize with the user's latest map (or even just edit the existing map?). This makes no sense; it should create a fresh new map.
b) Trying to create a map (or editing an existing map's name) with the same name as an existing map should cause an error.
c) The default names for maps shouldn't be `xatra, xatra_1, xatra_2...` but rather `new_map, new_map_1, new_map_2, ...`
d) There is some really weird behaviour where the slug etc. don't load properly until the map has rendered. This is very confusing, and there's no reason for it to be that way.

3) Keyboard shortcuts
a) When the import menu is focused, it should focus the search bar within it. Also, Escape should close the Import Menu (like Ctrl/Cmd+Shift+X already does)
b) Add keyboard shortcuts to the xatra menu: when it's open, pressing arrow keys should let you cycle through the elements in the menu (and pressing Escape should close it, just like Ctrl/Cmd+; already does)

4) Slug design
I don't really like all the slashes in displaying map names everywhere. That may be the slugs for `xatrahub(...)` commands, but it is ugly for a user interface. Instead:
a) The map title should simply be the name of the map (as an editable field), with the version button and copy button next to it, and the Builder Code toggle on the same line aligned to the right. _Below it_ on the next line, it should say "by {user who made the map, with a link to their profile} . 5 likes [heart] . 20 views" (where the heart button likes or unlikes the tweet, and shows it visually by changing color) (BTW, bizarrely it currently displays the username of the logged-in user in the title instead of that of the user who made the map being viewed---you should make sure not to repeat this mistake in your changes.)
b) In the Explore page (and thus also Import page), it should display the map name

5) Territory library tab
You did not implement the changes to the Territory library tab (in the map editor) that I requested at the very start. To recall:
a) The "Territory library" tab in the GUI, currently there are just two tabs "xatra.territory_library" and "Custom Library" (which is the "Custom territory library" created in this particular map) and they are in the side box. With an arbitrary number of territory libraries imported, they should instead all be listed (alongside "Custom Library") as sub-tabs under the main "Map Preview/Referennce Map/Territory library" tabs, with the sub-tabs updating when the territory library imports are chnaged.

6) Saving, descriptions and likes
a) I actually decided I no longer believe in the "copy" button for copying the `xatrahub()` slugs. Remove that button---both from next to the main map title, from the "Custom Territory library" section and from the "Custom Theme" section of the code editor. Instead, next to the heading "Custom Territory library" (of that section) place in monospaced font the slug for that territory library (e.g. `<username of the map author>/lib/<name of the map>`) and respectively for the "Custom Theme" section next to its heading place `<username of the map author>/css/<name of the map>`.
b) Change the label button icon to a standard Save icon.
c) Prompt for description when saving map (not when saving territory libraries or themes).

7) Overall site design
a) In dark mode, in the Explore/My Profile pages, the current page's item in the sidebar appears with a very light background, which causes flashing when one hovers over it. Fix that.
b) Instead of "My Profile", display the username (both in the xatra menu and in the Explore/My Profile sidebar).


8) Other bugs
a) The stuff in "Custom territory library" (in the Code editor) should get converted to Imports in the Builder interface---and NOT into "Python" layers.

-----

1) Decrease the width of the text box for the editable map title so that it and the version tag fit on one line. Right now in the Chrome Developr Tools I see a style in "Layer utilities" `.w-56 {width: calc(var(--spacing) * 56);}`; idk where this comes from but changing 56 to 40 helps.
2) Keyboard cycling through the xatra menu is messed-up. Sometimes it doesn't work at all; sometimes even when you cycle through it, pressing Enter selects "Load" instead of whatever I want to select; "Load" appears highlighted no matter what I do etc.
3) If logged-out users click the "My Profile" link, they should be redirected to the login page.
4) We need more indicators to show something is happening. E.g. when the "Explore" or profile screen are loading the list of maps, it should have a banner showing "Loading maps..." (same with the Import dialog) When the Login or Sign up buttons are pressed, it should immediately turn into a greyed-out "Logging in ..." or "Signing up ..." 
5) Make the "Map description" prompt use a dialog within the website's design rather than bizarrely using a browser pop-up for the purpose. Obviously make sure it is keyboard navigable (enter, escape should perform the expected functions)
6) Add "Users" list page and link to it in the sidebar. Each user item should link to their profile page. Also in Explore and the Import panel, the usernames of the author of each map should be linked.
7) Versions and publishing
a) I am observing very weird behaviour with how loading a page like `srajmabr/map/xatra_2_1` (which has versions up to 2) chooses its version. It starts at alpha when I first load it, then goes up to v1, then up to v2. What? Why does this happen? Instead it should just display the alpha version by default, as that is the latest. Even when the user publishes a new version, all continued edits after that should be on alpha. Make sure the logic for this works completely sensibly.
b) In fact, let us change the version-publishing UI and system a bit.
i) Instead of displaying a single button with the save icon and version number, we should have (1) a save button (with the save icon) and (2) a dropdown showing the versions of the map: v1, v2, ..., alpha. Selecting any one of them should take you to the respective `/v<number>` page. Any version besides alpha should not allow _any_ editing, even for the user who created it. 
ii) Similarly for the Custom Territory Library and Custom Theme sections in the Code editor. They should have a save button and a version dropdown instead of the single publish version button; and versions other than alpha should let us look at published versions read-only (while the little monospace slug next to the title updates to match it).
iii) Users other than the author should _not_ be allowed to edit any part of a map, in any version. **All** the input fields in both the Builder and Code editor should be greyed-out/read-only, and even if by chance he manages to submit anything at all, no change should get registered. This must be implemented on a very fundamental level.
iv) For users other than the author, as well as even the author looking at non-alpha versions of their own map, the "save" icon next to the map title should be replaced by a "fork" icon. Clicking on it should create a new map, identical to the map and version being viewed, but under the user's own namespace (the map name should be the same if possible, or if the user already has a map of that name, with a suitable `_<number>` prefix).
v) I am able to click the version button and publish a new version of version of Custom territory libraries and Custom themes on other users' maps. That shouldn't be allowed at all!


-----
1) Please make the Save button just an icon (no "Save" text). Same for the "Fork" button. Otherwise it won't fit in the space provided.
2) Why did you move the heart button to the first line? The first line won't fit in the space provided now. Move it back next to the like count. Actually, merge the like button and the like count, like it's a button that shows "[heart icon] 5 likes" then when you click it it changes color.
3) Also reduce the size of the input field to `{width: calc(var(--spacing) * 30);}` instead of 40.
4) For a non-logged-in user, the "New Map" UI doesn't need to have "by new_user · 0 likes · 0 views". That whole line could be removed for non logged in users (obviously, they should still see this line on other people's maps). In fact it is worth searching through the codebase for instances of `new_user` to figure out where that is used; we need to start deprecating that it is quite silly.

-----
Still a number of bugs.
1) Sometimes, even though I am clearly logged-in, creating a new map creates it as belonging to "guest"---wtf?
2) The presence of the default/automatic `srajma/lib/indic` import (i.e. `indic = xatrahub("/srajma/lib/indic/alpha")`) is erratic; it is sometimes added automatically when creating a new map, and sometimes not, it's very weird. Can you go through the logic for this and see if there's some overcomplication messing things up?
3) The Save buttons on the Custom territory library and Custom theme simply don't work.
4) In the Territory Library tab, the sub-tab for an imported territory library does not work correctly. Its checklist should have all the territories defined in that imported library (and if it has a `__TERRITORY_INDEX__` variable, only those should be checked; if it doesn't have that then everything should be checked)---i.e. exactly the same logic as we use for `xatra.territory_library`. Instead, for `srajma/lib/indic` I just see one checkbox which says "lib" and doesn't do anything.
5) I actually no longer like the whole "Prompt for description" thing. Descriptions should not be attached to versions but to the whole map, and should be displayed under the "by <author> . likes . views" line with a little edit icon.

In general I don't understand why the code is so buggy. I would like you to not only fix these particular bugs, but go through the code identifying (and where possible, immediately simplifying---otherwise just outlining the problem clearly for a future fix) all technical debt or over-convoluted logic that may be causing confusion.